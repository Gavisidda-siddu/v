{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - HealthConnect</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">HealthConnect</div>
            
            <div class="nav-links">
                <a href="{% url 'home' %}">üè† Home</a>
                <a href="{% url 'appointment' %}">üìÖ Appointments</a>
                <a href="{% url 'medication' %}">üíä Medications</a>
                <a href="{% url 'faq' %}">‚ùì FAQs</a>
                <a href="{% url 'bloodbank' %}">ü©∏ Blood Bank</a>
                <a href="{% url 'consultation' %}">üìπ Consultation</a>
                <a href="{% url 'records' %}">üìã Records</a>
                <a href="{% url 'chat' %}">üí¨ Chat</a>
            </div>
            
            <div class="profile-container">
                <button class="profile-icon" id="profile-icon">üë§</button>
                <div class="profile-dropdown" id="profile-dropdown">
                    <a href="profile.html">üìù View Profile</a>
                    <button onclick="handleUploadPhoto()">üì∑ Upload Photo</button>
                    <button class="logout-btn">üö™ Logout</button>
                </div>
            </div>
            
            <button class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobile-menu">
            <a href="{% url 'home' %}">üè† Home</a>
            <a href="{% url 'appointment' %}">üìÖ Appointments</a>
            <a href="{% url 'medication' %}">üíä Medications</a>
            <a href="{% url 'faq' %}">‚ùì FAQs</a>
            <a href="{% url 'bloodbank' %}">ü©∏ Blood Bank</a>
            <a href="{% url 'consultation' %}">üìπ Consultation</a>
            <a href="{% url 'records' %}">üìã Records</a>
            <a href="{% url 'chat' %}">üí¨ Chat</a>
            <a href="{% url 'profile' %}">üë§ Profile</a>
        </div>
    </nav>

    <div style="max-width: 600px; margin: 2rem auto;">
        <div class="card">
            <h2>üë§ User Profile</h2>
            
            <div style="text-align: center; margin-bottom: 2rem;">
                <div style="width: 100px; height: 100px; background: #4A90E2; border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
                    üë§
                </div>
                <h3 id="profile-name" style="color: #4A90E2;">Loading...</h3>
                <p id="profile-email" style="color: #666;">Loading...</p>
            </div>
            
            <form id="profile-form">
                <div class="form-group">
                    <label for="profile-phone">Phone Number</label>
                    <input type="tel" id="profile-phone" name="profile-phone" placeholder="Enter your phone number">
                </div>
                
                <div class="form-group">
                    <label for="profile-age">Age</label>
                    <input type="number" id="profile-age" name="profile-age" placeholder="Enter your age" min="1" max="120">
                </div>
                
                <div class="form-group">
                    <label for="profile-gender">Gender</label>
                    <select id="profile-gender" name="profile-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="profile-address">Address</label>
                    <textarea id="profile-address" name="profile-address" rows="3" placeholder="Enter your address"></textarea>
                </div>
                
                <button type="button" onclick="saveProfile()" class="btn btn-primary" style="width: 100%;">Save Changes</button>
            </form>
            
            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #E0E0E0;">
                <h3 style="margin-bottom: 1rem;">Account Actions</h3>
                <button onclick="logout()" class="btn btn-danger" style="width: 100%;">Logout</button>
            </div>
        </div>
    </div>

    <script>
        // Display user profile on page load
        document.addEventListener('DOMContentLoaded', function() {
            const user = getCurrentUser();
            if (user) {
                // Get saved profile or use current user
                const profileKey = `profile_${user.email}`;
                const savedProfile = localStorage.getItem(profileKey);
                const profile = savedProfile ? JSON.parse(savedProfile) : user;
                
                // Display name and email
                document.getElementById('profile-name').textContent = profile.name || user.name;
                document.getElementById('profile-email').textContent = profile.email || user.email;
                
                // Fill form fields
                if (document.getElementById('profile-phone')) {
                    document.getElementById('profile-phone').value = profile.phone || '';
                }
                if (document.getElementById('profile-age')) {
                    document.getElementById('profile-age').value = profile.age || '';
                }
                if (document.getElementById('profile-gender')) {
                    document.getElementById('profile-gender').value = profile.gender || '';
                }
                if (document.getElementById('profile-address')) {
                    document.getElementById('profile-address').value = profile.address || '';
                }
            }
        });
        
        function saveProfile() {
            const profileData = {
                name: document.getElementById('profile-name').textContent,
                email: document.getElementById('profile-email').textContent,
                phone: document.getElementById('profile-phone').value,
                age: document.getElementById('profile-age').value,
                gender: document.getElementById('profile-gender').value,
                address: document.getElementById('profile-address').value
            };
            
            // Get current user
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                const user = JSON.parse(currentUser);
                const profileKey = `profile_${user.email}`;
                localStorage.setItem(profileKey, JSON.stringify(profileData));
                
                // Update current user as well
                localStorage.setItem('currentUser', JSON.stringify(profileData));
            }
            
            alert('Profile updated successfully!');
        }
    </script>
    <script src="{% static 'js/script.js' %}"></script>
</body>
</html>

